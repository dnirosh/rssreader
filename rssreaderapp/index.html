<!DOCTYPE html> 
<html> 

<head> 
	<title>Movies and Games</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1">    
    <link rel="stylesheet" href="http://code.jquery.com/mobile/latest/jquery.mobile.min.css" />
    <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/latest/jquery.mobile.min.js"></script>
</head> 


</head> 
<body> 
<!-- Container page -->
<div data-role="page" data-theme="b" id="landPage">
	<div data-role="header" id="pageheader">
		<h1>Movies&Games</h1>
		
	</div>	
	
	<div data-role="content" id="buttonContent">
        <a data-role="button" href="" id="movieButton">
            Movies
        </a>
        <a data-role="button" href="" id="gameButton">
            Games
        </a>
	</div>
	
	<div data-role="content" id="movieContent">    
        <ul id="MovielinksList" data-role="listview" data-inset="true"></ul>
    </div>
	
	<div data-role="content" id="gameContent">    
        <ul id="GamelinksList" data-role="listview" data-inset="true"></ul>
    </div> 	
	
	<div data-role="content" id="welcomeContent">
		<h3> Welcome to the Movies and Games Application </h3>
		<h3> where you get to see only the hottest and latest of games'n movies over a beer !<h3>
	</div>

	
    <div id="mgfooter" data-theme="a" data-role="footer" data-position="fixed" >
        <h4>Powered by Exilesoft - Evening Brew </h4>
    </div>	 
</div>

	<script>
	    var contentRSSDescription = $('#welcomeContent');
		var movieRSSFeed = 'http://i.rottentomatoes.com/syndication/rss/upcoming.xml';
		var gameNewsRSSFeed = 'http://www.gamespot.com/feeds/news/';
		var gameNewReleasesRSSFeed = 'http://www.gamespot.com/feeds/new_releases/';
		
		$(document).ready(function () {   	   
			contentRSSDescription.html('sending req1...');
			populate(null);
		});
		
		function getRSSData(handler,url){
			//$('#contentRSSDescription').load('http://lkr.fxexchangerate.com/rss.xml');
		
		    //var varURI = 'http://i.rottentomatoes.com/syndication/rss/upcoming.xml';
			
			$.ajax({type: 'GET', dataType: 'xml', url: url, success: handler ,
			beforeSend: function(xhr) {
				xhr.setRequestHeader("Access-Control-Allow-Origin", "*");
			},
			 error: function (xhr, textStatus, errorThrown) {
						contentRSSDescription.html('error:' + errorThrown);
					}
			});
		}
		
		function populate(xml){
			contentRSSDescription.html('debug.1');
			if(xml==null||xml==''){
				var xmlStr='<rss><channel><item><title>RealSteel</title><link>www.realsteel.com</link><description>Real Deal</description></item></channel></rss>';
				xml = $.parseXML( xmlStr );
			}
			else
		     contentRSSDescription.html($(xml).find("item").text());
			//alert(xml);
			var entries = [];
			var s = '';
			
			$(xml).find("item").each(function(i,v){
				entry = { 
						title:$(v).find("title").text(), 
						link:$(v).find("link").text(), 
						description:$.trim($(v).find("description").text())
					};
				entries.push(entry);
				s += '<ul><a href="#contentPage" class="contentLink" data-entryid="'+i+'">' + $(v).find("title").text() + '</a></ul>';

				contentRSSDescription.html($(this).find("description").text());
				
			});
			
			$("#MovielinksList").append(s);
			$("#MovielinksList").listview("refresh");
		    $("#GamelinksList").append(s);
			$("#GamelinksList").listview("refresh");
		}
		
		//Game functions
		function hideGame(){
			$("#gameContent").hide();
		}
		function showGame(){
			getRSSData(populate ,gameNewsRSSFeed);
			$("#gameContent").show();
		}
		function hideLandPage(){
			$("#buttonContent").hide();
			$("#welcomeContent").hide();
		};
		
		$('#gameButton').click(function() {
		  hideLandPage();
		  hideMovie();
		  showGame();
		  return false;      
		});
		
		//Movie functions
		function hideMovie(){
			$("#movieContent").hide();
		}
		function showMovie(){
		    getRSSData(populate ,movieRSSFeed);
			$("#movieContent").show();
		}
		
		$('#movieButton').click(function() {
		  hideLandPage();
		  hideGame();
		  showMovie();
		  return false;      
		});
		
	</script>

</body> 
</html> 